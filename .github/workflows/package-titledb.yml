name: Package and Release TitleDB

on:
  schedule:
    # æ¯å°æ—¶è¿è¡Œä¸€æ¬¡ï¼ˆæ¯å°æ—¶çš„ç¬¬0åˆ†é’Ÿï¼‰
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  package-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Merge directories and create ZIP
        run: |
          mkdir -p temp_merge
          
          # æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
          if [ -d "output/titleid/" ]; then
            echo "æ‰¾åˆ° output/titleid/ ç›®å½•"
            rsync -a --ignore-existing output/titleid/ temp_merge/ 2>/dev/null || true
          else
            echo "è­¦å‘Š: output/titleid/ ç›®å½•ä¸å­˜åœ¨"
          fi
          
          if [ -d "output2/titleid/" ]; then
            echo "æ‰¾åˆ° output2/titleid/ ç›®å½•"
            rsync -a --ignore-existing output2/titleid/ temp_merge/ 2>/dev/null || true
          else
            echo "è­¦å‘Š: output2/titleid/ ç›®å½•ä¸å­˜åœ¨"
          fi
          
          echo "æ–‡ä»¶åˆå¹¶å®Œæˆã€‚å‡†å¤‡æ‰“åŒ…..."
          zip -r titleid.zip temp_merge/
          echo "ZIPåŒ…åˆ›å»ºå®Œæˆã€‚æ–‡ä»¶å¤§å°:"
          ls -lh titleid.zip

      - name: Upload to Release (ä½¿ç”¨æ ‡ç­¾)
        uses: softprops/action-gh-release@v1
        with:
          # ä½¿ç”¨å›ºå®šæ ‡ç­¾è€Œä¸æ˜¯æ— æ ‡ç­¾Release
          tag_name: "latest-package"
          name: "Switchæ¸¸æˆä¿¡æ¯åº“"
          body: |
            ğŸ® **Switchæ¸¸æˆä¿¡æ¯åº“**
            
            æ­¤é¡¹ç›®å†…å®¹ä¸ºSwitchæ¸¸æˆä¿¡æ¯æ•°æ®ï¼Œæ¯å°æ—¶å®šæœŸæ›´æ–°ï¼Œæ”¯æŒæ˜¾ç¤ºæ¸¸æˆæˆªå›¾ï¼Œæ¸¸æˆå‚å•†ä»¥åŠæ¸¸æˆå¤§å°ç­‰å†…å®¹ã€‚
            
            **æ›´æ–°æ—¶é—´:** ${{ github.event.schedule || 'æ‰‹åŠ¨è§¦å‘' }}
            **ç”Ÿæˆæ—¶é—´:** ${{ github.event.head_commit.timestamp || github.run_started_at }}
            **å·¥ä½œæµè¿è¡Œ:** [#${{ github.run_number }}](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})
            
            **åŒ…å«å†…å®¹:**
            - `/output/titleid/` - æ¸¸æˆä¿¡æ¯æ•°æ®
            - `/output2/titleid/` - é™„åŠ æ¸¸æˆä¿¡æ¯
            
            ğŸ“Š æœ¬ä»“åº“æ¯å°æ—¶è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡ï¼Œç¡®ä¿æ•°æ®æœ€æ–°ã€‚
          # ä½¿ç”¨ append_body æ¥ä¿ç•™ä¹‹å‰çš„æ›´æ–°è®°å½•
          append_body: false
          # æ¯æ¬¡è¦†ç›–åŒæ ‡ç­¾çš„Release
          draft: false
          prerelease: false
          generate_release_notes: false
          files: titleid.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
